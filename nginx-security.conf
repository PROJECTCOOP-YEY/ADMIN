# ========================================
# COMPREHENSIVE SECURITY HEADERS FOR NGINX
# ========================================
# Add these directives to your nginx.conf or site configuration
# This provides maximum security for your website

# ========================================
# HTTP STRICT TRANSPORT SECURITY (HSTS)
# ========================================
# Forces HTTPS connections and prevents protocol downgrade attacks
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;

# ========================================
# CONTENT SECURITY POLICY (CSP)
# ========================================
# Prevents XSS attacks by controlling resource loading
add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.tailwindcss.com https://cdn.jsdelivr.net https://www.gstatic.com https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: blob:; connect-src 'self' https://presidential-car-museum-default-rtdb.asia-southeast1.firebasedatabase.app https://*.firebaseapp.com; frame-ancestors 'self'; base-uri 'self'; form-action 'self'; object-src 'none'; upgrade-insecure-requests; block-all-mixed-content;" always;

# ========================================
# X-FRAME-OPTIONS
# ========================================
# Prevents clickjacking attacks by controlling iframe embedding
add_header X-Frame-Options "SAMEORIGIN" always;

# ========================================
# X-CONTENT-TYPE-OPTIONS
# ========================================
# Prevents MIME type sniffing attacks
add_header X-Content-Type-Options "nosniff" always;

# ========================================
# REFERRER POLICY
# ========================================
# Controls referrer information sent with requests
add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# ========================================
# PERMISSIONS POLICY
# ========================================
# Controls browser features and APIs
add_header Permissions-Policy "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), speaker=(), vibrate=(), fullscreen=(self), sync-xhr=(), accelerometer=(), ambient-light-sensor=(), autoplay=(), battery=(), bluetooth=(), clipboard-read=(), clipboard-write=(), cross-origin-isolated=(), display-capture=(), document-domain=(), encrypted-media=(), execution-while-not-rendered=(), execution-while-out-of-viewport=(), focus-without-user-activation=(), gamepad=(), gyroscope=(), hid=(), identity-credentials-get=(), idle-detection=(), local-fonts=(), magnetometer=(), midi=(), otp-credentials=(), payment=(), picture-in-picture=(), publickey-credentials-create=(), publickey-credentials-get=(), screen-wake-lock=(), serial=(), storage-access=(), usb=(), web-share=(), xr-spatial-tracking=()" always;

# ========================================
# ADDITIONAL SECURITY HEADERS
# ========================================

# X-XSS-Protection (legacy but still useful)
add_header X-XSS-Protection "1; mode=block" always;

# X-Download-Options (IE specific)
add_header X-Download-Options "noopen" always;

# X-Permitted-Cross-Domain-Policies
add_header X-Permitted-Cross-Domain-Policies "none" always;

# Cross-Origin-Embedder-Policy
add_header Cross-Origin-Embedder-Policy "require-corp" always;

# Cross-Origin-Opener-Policy
add_header Cross-Origin-Opener-Policy "same-origin" always;

# Cross-Origin-Resource-Policy
add_header Cross-Origin-Resource-Policy "same-origin" always;

# ========================================
# CACHE CONTROL FOR SENSITIVE PAGES
# ========================================
location ~* \.(html|htm)$ {
    add_header Cache-Control "no-cache, no-store, must-revalidate" always;
    add_header Pragma "no-cache" always;
    add_header Expires "0" always;
}

# ========================================
# CSP REPORTING (OPTIONAL)
# ========================================
# Uncomment the line below to enable CSP violation reporting
# add_header Content-Security-Policy-Report-Only "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.tailwindcss.com https://cdn.jsdelivr.net https://www.gstatic.com https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: blob:; connect-src 'self' https://presidential-car-museum-default-rtdb.asia-southeast1.firebasedatabase.app https://*.firebaseapp.com; frame-ancestors 'self'; base-uri 'self'; form-action 'self'; object-src 'none'; upgrade-insecure-requests; block-all-mixed-content; report-uri /csp-report;" always;

# ========================================
# ADDITIONAL NGINX SECURITY CONFIGURATIONS
# ========================================

# Hide Nginx version
server_tokens off;

# Prevent access to sensitive files
location ~* \.(htaccess|htpasswd|ini|log|sh|inc|bak|sql|conf)$ {
    deny all;
}

# Prevent directory browsing
autoindex off;

# Limit request size
client_max_body_size 10M;

# Timeout settings
client_body_timeout 12;
client_header_timeout 12;
keepalive_timeout 15;
send_timeout 10;

# Buffer settings
client_body_buffer_size 128k;
client_header_buffer_size 1k;
large_client_header_buffers 4 4k;

# Gzip compression
gzip on;
gzip_vary on;
gzip_min_length 1024;
gzip_proxied any;
gzip_comp_level 6;
gzip_types
    text/plain
    text/css
    text/xml
    text/javascript
    application/json
    application/javascript
    application/xml+rss
    application/atom+xml
    image/svg+xml;

# Additional Security Headers
add_header X-XSS-Protection "1; mode=block" always;
add_header Cache-Control "no-cache, no-store, must-revalidate" always;
add_header Pragma "no-cache" always;
add_header Expires "0" always;

# Remove Server Information
server_tokens off;

# Force HTTPS (uncomment if you have SSL certificate)
# return 301 https://$server_name$request_uri;
